# TD_NonLinearCombineFit

### Function Name
**TD_NonLinearCombineFit**

### Description
TD_NonLinearCombineFit returns the target columns and a specified formula which uses the non-linear combination of existing features. This function is a powerful feature engineering technique that combines existing features in a non-linear way to create new features that capture more complex relationships between the original features and the target variable.

By combining features in a non-linear way, this technique can create features that are not explicitly present in the original dataset. These derived features can help simplify the model, reduce overfitting, improve interpretability, and identify the most relevant feature combinations for predictive modeling.

### When the Function Would Be Used
- **Feature Engineering**: Create polynomial and interaction features for machine learning
- **Capturing Non-linear Relationships**: Model complex interactions between variables
- **Dimensionality Expansion**: Generate additional features from existing ones
- **Domain Knowledge Integration**: Encode known relationships as formula-based features
- **Model Performance**: Improve predictive accuracy through feature combinations
- **Interaction Terms**: Create multiplicative features (e.g., area = length × width)
- **Polynomial Features**: Generate squared, cubed, or other power terms
- **Mathematical Relationships**: Implement domain-specific formulas
- **Feature Selection**: Evaluate performance with different feature combinations
- **Reducing Model Complexity**: Create composite features that replace multiple simple features

### Syntax
```sql
TD_NonLinearCombineFit (
    ON { table | view | (query) } AS InputTable
    [ OUT [ PERMANENT | VOLATILE ] TABLE OutputTable(output_table_name) ]
    USING
    TargetColumns ({'target_column' | 'target_column_range'}[,...])
    Formula ('Y = expression')
    [ ResultColumn ('result_column') ]
)
```

### Required Syntax Elements for TD_NonLinearCombineFit

**ON clause**
- Specify the table name, view name, or query as InputTable

**TargetColumns**
- Specify the input table column names to use in the non-linear combination
- Columns must be numeric types
- Supports column range notation (e.g., '[0:2]')

**Formula**
- Specify the formula for combining features
- Format: 'Y = expression'
- In expression, use X0, X1, X2, etc. to reference columns in TargetColumns order
- Can use arithmetic, trigonometric, and hyperbolic operators/functions
- See Teradata SQL Functions documentation for supported operators

### Optional Syntax Elements for TD_NonLinearCombineFit

**OUT clause**
- Accepts the OutputTable clause
- Specify PERMANENT or VOLATILE table type
- If not specified, function returns result directly

**ResultColumn**
- Specify the new feature column name generated by the Transform function
- The Fit function saves the specified formula in this column
- Default: 'TD_CombinedValue'

### Input Table Schema

| Column | Data Type | Description |
|--------|-----------|-------------|
| TargetColumns | BYTEINT, SMALLINT, INTEGER, BIGINT, DECIMAL, NUMERIC, FLOAT, REAL, DOUBLE PRECISION | Input table column names to use in non-linear combination |

### Output Table Schema

| Column | Data Type | Description |
|--------|-----------|-------------|
| ResultColumn | VARCHAR CHARACTER SET UNICODE | The Formula element displays in this column |
| TargetColumns | BYTEINT, SMALLINT, INTEGER, BIGINT, DECIMAL, NUMERIC, FLOAT, REAL, DOUBLE PRECISION | The specified target columns displayed as NULL values |

### Code Examples

**Input Table: nonLinearCombineFit_input**
```
passenger  survived  pclass  gender  age  sibsp  parch  fare     cabin  embarked
1          0         General male    22   1      0      7.25     null   S
2          1         Deluxe  female  38   1      1      71.28    C85    C
3          1         General female  26   0      0      7.93     null   S
4          1         Deluxe  female  35   1      0      53.10    C123   S
5          0         General male    35   0      1      8.05     null   S
```

**Example 1: Calculate Total Cost (Family Size × Fare)**
```sql
SELECT * FROM TD_NonLinearCombineFit (
    ON nonLinearCombineFit_input AS InputTable
    OUT TABLE FitTable (nonLinearCombineFit_output)
    USING
    TargetColumns ('SibSp', 'Parch', 'Fare')
    Formula ('Y=(X0+X1+1)*X2')
    ResultColumn ('TotalCost')
) AS dt
ORDER BY 1;
```

**Output Table:**
```
total_cost         sibsp  parch  fare
Y=(X0+X1+1)*X2     null   null   null
```

**Example 2: Calculate Area from Length and Width**
```sql
SELECT * FROM TD_NonLinearCombineFit (
    ON measurements AS InputTable
    OUT TABLE area_fit
    USING
    TargetColumns ('length', 'width')
    Formula ('Y=X0*X1')
    ResultColumn ('area')
) AS dt;
```

**Example 3: Calculate BMI (Body Mass Index)**
```sql
-- BMI = weight / (height^2)
SELECT * FROM TD_NonLinearCombineFit (
    ON health_data AS InputTable
    OUT TABLE bmi_fit
    USING
    TargetColumns ('weight_kg', 'height_m')
    Formula ('Y=X0/(X1*X1)')
    ResultColumn ('bmi')
) AS dt;
```

**Example 4: Polynomial Features (Square and Product)**
```sql
-- Create X1^2 and X1*X2
SELECT * FROM TD_NonLinearCombineFit (
    ON feature_data AS InputTable
    OUT TABLE poly_fit
    USING
    TargetColumns ('feature1', 'feature2')
    Formula ('Y=X0*X0+X0*X1')
    ResultColumn ('poly_feature')
) AS dt;
```

**Example 5: Revenue Calculation**
```sql
-- Revenue = quantity * unit_price * (1 - discount_rate)
SELECT * FROM TD_NonLinearCombineFit (
    ON sales_data AS InputTable
    OUT TABLE revenue_fit
    USING
    TargetColumns ('quantity', 'unit_price', 'discount_rate')
    Formula ('Y=X0*X1*(1-X2)')
    ResultColumn ('revenue')
) AS dt;
```

**Example 6: Distance Formula (2D Euclidean)**
```sql
-- Distance = sqrt(x^2 + y^2)
SELECT * FROM TD_NonLinearCombineFit (
    ON coordinates AS InputTable
    OUT TABLE distance_fit
    USING
    TargetColumns ('x_coordinate', 'y_coordinate')
    Formula ('Y=SQRT(X0*X0+X1*X1)')
    ResultColumn ('distance_from_origin')
) AS dt;
```

**Example 7: Compound Interest**
```sql
-- Amount = principal * (1 + rate)^years
SELECT * FROM TD_NonLinearCombineFit (
    ON investment_data AS InputTable
    OUT TABLE compound_fit
    USING
    TargetColumns ('principal', 'annual_rate', 'years')
    Formula ('Y=X0*POWER(1+X1, X2)')
    ResultColumn ('future_value')
) AS dt;
```

**Example 8: Profit Margin Percentage**
```sql
-- Profit Margin = ((revenue - cost) / revenue) * 100
SELECT * FROM TD_NonLinearCombineFit (
    ON financial_data AS InputTable
    OUT TABLE margin_fit
    USING
    TargetColumns ('revenue', 'cost')
    Formula ('Y=((X0-X1)/X0)*100')
    ResultColumn ('profit_margin_pct')
) AS dt;
```

**Example 9: Interaction Term for ML**
```sql
-- Create interaction feature: age * income
SELECT * FROM TD_NonLinearCombineFit (
    ON customer_data AS InputTable
    OUT TABLE interaction_fit
    USING
    TargetColumns ('age', 'annual_income')
    Formula ('Y=X0*X1/1000')  -- Scaled down for better range
    ResultColumn ('age_income_interaction')
) AS dt;
```

**Example 10: Complex Multi-term Formula**
```sql
-- Create complex feature: (X0^2 + X1^2) / (X2 + 1)
SELECT * FROM TD_NonLinearCombineFit (
    ON ml_features AS InputTable
    OUT TABLE complex_fit
    USING
    TargetColumns ('feature_a', 'feature_b', 'feature_c')
    Formula ('Y=(X0*X0+X1*X1)/(X2+1)')
    ResultColumn ('complex_feature')
) AS dt;
```

### Feature Engineering Benefits

**1. Capturing Complex Relationships**
- Non-linear combinations reveal patterns linear models miss
- Interaction terms show how features influence each other
- Polynomial terms capture curved relationships

**2. Dimensionality Expansion**
- Create more features for better model expressiveness
- Generate domain-specific computed features
- Increase model capacity without collecting new data

**3. Model Simplification**
- Replace multiple simple features with one composite feature
- Reduce number of parameters in some cases
- Improve interpretability through meaningful combinations

**4. Reducing Overfitting**
- Well-chosen combinations can regularize models
- Domain knowledge helps select meaningful features
- Reduces reliance on spurious correlations

**5. Performance Improvement**
- Captures non-linear patterns in data
- Helps models learn complex decision boundaries
- Can significantly improve predictive accuracy

### Formula Guidelines

**Arithmetic Operators**:
- Addition: X0 + X1
- Subtraction: X0 - X1
- Multiplication: X0 * X1
- Division: X0 / X1
- Power: POWER(X0, 2) or X0*X0

**Common Patterns**:
- **Product**: X0*X1 (interaction)
- **Sum**: X0+X1 (combined effect)
- **Ratio**: X0/X1 (relative comparison)
- **Squared**: X0*X0 (polynomial feature)
- **Weighted Sum**: (X0*w1 + X1*w2)

**Best Practices**:
- Use meaningful combinations based on domain knowledge
- Scale features appropriately to avoid overflow
- Add small constants to denominators to avoid division by zero
- Test formulas with sample data before full deployment
- Document the business logic behind each formula

### Use Cases and Applications

**1. Machine Learning Feature Engineering**
- Create polynomial features for regression
- Generate interaction terms for tree models
- Design composite features for neural networks
- Improve model performance through engineered features

**2. Business Metrics**
- Calculate KPIs from raw data (e.g., conversion rate, ROI)
- Create derived financial metrics
- Compute efficiency ratios
- Generate performance indicators

**3. Scientific Computing**
- Implement physics formulas (e.g., force, energy, momentum)
- Calculate chemical concentrations
- Compute engineering metrics
- Apply mathematical models

**4. Financial Analysis**
- Calculate returns, ratios, and growth rates
- Compute risk metrics
- Generate profitability indicators
- Create composite scores

**5. Healthcare Analytics**
- Calculate BMI, dosage adjustments
- Compute risk scores
- Generate health indices
- Create composite patient metrics

**6. E-commerce**
- Calculate basket value, average order value
- Compute customer lifetime value estimates
- Generate engagement scores
- Create recommendation features

### Important Notes
- Formula must be valid SQL expression
- Target columns referenced as X0, X1, X2, etc. in order specified
- Output table contains formula as string, target columns as NULL
- Actual computation performed by TD_NonLinearCombineTransform
- Supports arithmetic, trigonometric, and hyperbolic functions
- Division by zero should be handled in formula (add small constant)
- ResultColumn name used in TD_NonLinearCombineTransform output
- Formula stored as-is; validated during Transform execution
- Can create multiple fit tables with different formulas
- Domain knowledge crucial for selecting meaningful combinations

### Related Functions
- **TD_NonLinearCombineTransform** - Applies formula to create new features (must be used after TD_NonLinearCombineFit)
- **TD_PolynomialFeaturesFit** - Automatic polynomial feature generation
- **TD_FunctionFit** - Single-column transformations
- **TD_ColumnTransformer** - Combined transformation pipeline

### Additional Resources
- [Teradata Database Analytic Functions Documentation](https://docs.teradata.com)
- [Teradata SQL Functions, Expressions, and Predicates](https://docs.teradata.com) (B035-1145)
- Official Examples and Use Cases in B035-1206-172K.pdf

---

**File Generated**: 2025-11-22
**Source**: Teradata Database Analytic Functions (B035-1206-172K.pdf, Release 17.20)
**Function Category**: Feature Engineering Transform Functions
