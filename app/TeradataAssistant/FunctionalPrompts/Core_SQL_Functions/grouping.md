# GROUPING

### Function Name
**GROUPING**

### Description
Returns a value that indicates whether a specified column in the result row was excluded from the grouping set of a GROUP BY clause. Returns 1 if the column was excluded (representing all values), and 0 if the column was included.

### When the Function Would Be Used
- Distinguish between actual nulls and nulls generated by GROUPING SETS
- Identify which columns are aggregated in GROUP BY CUBE operations
- Determine grouping levels in hierarchical GROUP BY queries
- Handle complex aggregations with ROLLUP and GROUPING SETS
- Create conditional logic based on grouping inclusion
- Replace aggregated nulls with descriptive text
- Understand multi-level aggregation results

### Syntax
```sql
GROUPING (expression)
```

### Code Examples

**Example 1: Basic GROUPING with GROUPING SETS**
```sql
SELECT 
    county, city, SUM(margin),
    GROUPING(county) AS County_Grouping,
    GROUPING(city) AS City_Grouping
FROM sales_view
GROUP BY GROUPING SETS ((county),(city));
```

**Example 2: GROUPING with CASE to Replace Nulls**
```sql
SELECT 
    CASE WHEN GROUPING(county) = 1 THEN '-All Counties-' ELSE county END AS County,
    CASE WHEN GROUPING(city) = 1 THEN '-All Cities-' ELSE city END AS City,
    SUM(margin) AS TotalMargin
FROM sales_view
GROUP BY GROUPING SETS (county, city);
```

**Example 3: GROUPING with ROLLUP**
```sql
SELECT 
    Year,
    Quarter,
    SUM(Sales) AS TotalSales,
    GROUPING(Year) AS Year_Grouping,
    GROUPING(Quarter) AS Quarter_Grouping
FROM SalesData
GROUP BY ROLLUP (Year, Quarter);
```

**Example 4: GROUPING with CUBE**
```sql
SELECT 
    Region,
    Product,
    SUM(Quantity) AS TotalQuantity,
    GROUPING(Region) AS Region_Grouping,
    GROUPING(Product) AS Product_Grouping
FROM Sales
GROUP BY CUBE (Region, Product);
```

**Example 5: Multiple GROUPING Columns**
```sql
SELECT 
    Department,
    Job_Title,
    Location,
    COUNT(*) AS EmployeeCount,
    GROUPING(Department) + GROUPING(Job_Title) + GROUPING(Location) AS Grouping_Level
FROM Employee
GROUP BY GROUPING SETS 
    ((Department), (Department, Job_Title), (Department, Job_Title, Location));
```

**Example 6: GROUPING with Filtering**
```sql
SELECT 
    Region,
    State,
    SUM(Revenue) AS TotalRevenue
FROM RegionalSales
WHERE GROUPING(Region) = 0
GROUP BY GROUPING SETS ((Region), (Region, State));
```

**Example 7: GROUPING Identifying Subtotal Rows**
```sql
SELECT 
    ProductCategory,
    ProductSubcategory,
    SUM(Sales) AS CategorySales,
    CASE 
        WHEN GROUPING(ProductCategory) = 1 AND GROUPING(ProductSubcategory) = 1 THEN 'Grand Total'
        WHEN GROUPING(ProductSubcategory) = 1 THEN 'Category Subtotal'
        ELSE 'Detail Row'
    END AS RowType
FROM ProductSales
GROUP BY ROLLUP (ProductCategory, ProductSubcategory);
```

**Example 8: GROUPING with ORDER BY**
```sql
SELECT 
    Division,
    Department,
    SUM(Budget) AS DeptBudget,
    GROUPING(Division) AS Div_Grouping,
    GROUPING(Department) AS Dept_Grouping
FROM BudgetData
GROUP BY ROLLUP (Division, Department)
ORDER BY Div_Grouping DESC, Division, Dept_Grouping DESC;
```

**Example 9: GROUPING to Exclude Aggregated Rows**
```sql
SELECT 
    Year,
    Month,
    SUM(Revenue) AS MonthlyRevenue
FROM TransactionData
GROUP BY ROLLUP (Year, Month)
WHERE GROUPING(Year) + GROUPING(Month) = 0
ORDER BY Year, Month;
```

**Example 10: GROUPING with Conditional Aggregation**
```sql
SELECT 
    CASE WHEN GROUPING(Region) = 1 THEN 'TOTAL' ELSE Region END AS Region,
    CASE WHEN GROUPING(Territory) = 1 THEN 'ALL' ELSE Territory END AS Territory,
    SUM(Sales) AS TotalSales,
    COUNT(DISTINCT SalesPersonID) AS SalesPersonCount
FROM SalesPerformance
GROUP BY CUBE (Region, Territory);
```

---

---

**File Generated**: 2025-11-22
**Source**: Teradata Database Analytic Functions (B035-1206-172K.pdf, Release 17.20)
